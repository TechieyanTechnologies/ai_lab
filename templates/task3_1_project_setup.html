<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 3.1: Project Setup & Class Selection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .task-header { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 2rem 0; }
        .learning-objective { background: #f8f9fa; padding: 1rem; border-left: 4px solid #f5576c; }
        .class-badge { padding: 0.5rem 1rem; margin: 0.25rem; display: inline-block; }
        .class-input-group { margin-bottom: 1rem; }
        .project-card { border: 2px solid #f5576c; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div class="task-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-project-diagram me-3"></i>Task 3.1: Project Setup & Class Selection</h1>
                    <p class="lead mb-0">Create your image recognition project and define object classes</p>
                </div>
                <a href="/level/3" class="btn btn-light">‚Üê Back to Level 3</a>
            </div>
        </div>
    </div>

    <div class="container py-4">
        <!-- Learning Objective -->
        <div class="learning-objective mb-4">
            <h4><i class="fas fa-bullseye me-2"></i>Learning Objective</h4>
            <p class="mb-0">Learn to set up an image recognition project, define detection classes, and organize your workspace for training custom object detection models.</p>
        </div>

        <!-- Project Setup Form -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h4><i class="fas fa-folder-open me-2"></i>Create New Project</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-tag me-2"></i>Project Name</label>
                            <input type="text" class="form-control" id="projectName" placeholder="e.g., Custom Object Detector" value="My Image Project">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-info-circle me-2"></i>Project Description (Optional)</label>
                            <input type="text" class="form-control" id="projectDesc" placeholder="Brief description of your project">
                        </div>
                    </div>
                </div>

                <!-- Class Selection -->
                <div class="mb-4">
                    <label class="form-label"><i class="fas fa-list me-2"></i>Define Object Classes</label>
                    <p class="small text-muted">Specify the classes/objects you want to detect (e.g., person, car, dog, cat, etc.)</p>
                    
                    <div id="classesContainer">
                        <!-- Classes will be added here -->
                    </div>
                    
                    <div class="class-input-group">
                        <div class="input-group">
                            <input type="text" class="form-control" id="newClassInput" placeholder="Enter class name (e.g., person, car, dog)">
                            <button class="btn btn-primary" onclick="addClass()">
                                <i class="fas fa-plus me-2"></i>Add Class
                            </button>
                        </div>
                        <small class="text-muted">Tip: Start with 2-5 classes for your first project</small>
                    </div>

                    <!-- Quick Add Buttons -->
                    <div class="mt-3">
                        <p class="small mb-2"><strong>Quick Add Common Classes:</strong></p>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('person')">Person</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('car')">Car</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('dog')">Dog</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('cat')">Cat</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('bicycle')">Bicycle</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('chair')">Chair</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('book')">Book</button>
                        <button class="btn btn-sm btn-outline-secondary me-2 mb-2" onclick="quickAddClass('phone')">Phone</button>
                    </div>

                    <!-- Selected Classes Display -->
                    <div id="selectedClasses" class="mt-3" style="display: none;">
                        <p class="small mb-2"><strong>Selected Classes:</strong></p>
                        <div id="classesList"></div>
                    </div>
                </div>

                <!-- Create Project Button -->
                <div class="text-center mt-4">
                    <button class="btn btn-success btn-lg" onclick="createProject()">
                        <i class="fas fa-rocket me-2"></i>Create Project
                    </button>
                </div>

                <!-- Project Status -->
                <div id="projectStatus" class="mt-4" style="display: none;"></div>
            </div>
        </div>

        <!-- Project Info (shown after creation) -->
        <div class="project-card" id="projectInfoCard" style="display: none;">
            <h5><i class="fas fa-check-circle text-success me-2"></i>Project Created Successfully!</h5>
            <div id="projectInfo"></div>
            <div class="mt-3">
                <a href="/level/3/task/2" class="btn btn-primary">
                    <i class="fas fa-arrow-right me-2"></i>Next: Upload Images
                </a>
            </div>
        </div>

        <!-- Help Section -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5><i class="fas fa-question-circle me-2"></i>Tips & Best Practices</h5>
            </div>
            <div class="card-body">
                <ul>
                    <li><strong>Class Names:</strong> Use lowercase, single words or short phrases (e.g., "person", "traffic_light")</li>
                    <li><strong>Number of Classes:</strong> Start with 2-5 classes for your first project</li>
                    <li><strong>Naming:</strong> Avoid special characters and spaces in class names</li>
                    <li><strong>Planning:</strong> Think about what objects you want to detect and ensure you have images for each class</li>
                    <li><strong>Next Step:</strong> After creating the project, you'll upload images for each class</li>
                </ul>
            </div>
        </div>

        <!-- Navigation -->
        <div class="card mt-4">
            <div class="card-body text-center">
                <a href="/level/3" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-arrow-left me-2"></i>Back to Level 3
                </a>
                <a href="/level/3/task/2" class="btn btn-primary" id="nextTaskBtn" style="display: none;">
                    Next Task <i class="fas fa-arrow-right ms-2"></i>
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedClasses = [];
        let currentProjectId = null;

        function addClass() {
            const input = document.getElementById('newClassInput');
            const className = input.value.trim().toLowerCase();
            
            if (!className) {
                alert('Please enter a class name');
                return;
            }
            
            if (className.includes(' ') || className.includes('/') || className.includes('\\')) {
                alert('Class names should not contain spaces or special characters');
                return;
            }
            
            if (selectedClasses.includes(className)) {
                alert('Class already added');
                return;
            }
            
            selectedClasses.push(className);
            input.value = '';
            updateClassesDisplay();
        }

        function quickAddClass(className) {
            if (!selectedClasses.includes(className)) {
                selectedClasses.push(className);
                updateClassesDisplay();
            }
        }

        function removeClass(className) {
            selectedClasses = selectedClasses.filter(c => c !== className);
            updateClassesDisplay();
        }

        function updateClassesDisplay() {
            const container = document.getElementById('classesList');
            const selectedDiv = document.getElementById('selectedClasses');
            
            if (selectedClasses.length === 0) {
                selectedDiv.style.display = 'none';
                return;
            }
            
            selectedDiv.style.display = 'block';
            container.innerHTML = '';
            
            selectedClasses.forEach(className => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary class-badge';
                badge.innerHTML = `
                    ${className}
                    <button type="button" class="btn-close btn-close-white ms-2" onclick="removeClass('${className}')" style="font-size: 0.7rem;"></button>
                `;
                container.appendChild(badge);
            });
        }

        async function createProject() {
            const projectName = document.getElementById('projectName').value.trim();
            const projectDesc = document.getElementById('projectDesc').value.trim();
            
            if (!projectName) {
                alert('Please enter a project name');
                return;
            }
            
            if (selectedClasses.length === 0) {
                alert('Please add at least one class');
                return;
            }
            
            if (selectedClasses.length > 20) {
                alert('Maximum 20 classes allowed. Please reduce the number of classes.');
                return;
            }
            
            try {
                const response = await fetch('/level/3/create-project', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name: projectName,
                        description: projectDesc,
                        classes: selectedClasses
                    })
                });
                
                const data = await response.json();
                
                if (data.project_id) {
                    currentProjectId = data.project_id;
                    localStorage.setItem('level3_project_id', currentProjectId);
                    localStorage.setItem('level3_classes', JSON.stringify(selectedClasses));
                    localStorage.setItem('level3_project_name', projectName);
                    
                    // Show success
                    document.getElementById('projectStatus').innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>Project created successfully!
                        </div>
                    `;
                    document.getElementById('projectStatus').style.display = 'block';
                    
                    // Show project info
                    document.getElementById('projectInfo').innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Project ID:</strong> <code>${currentProjectId}</code></p>
                                <p><strong>Project Name:</strong> ${projectName}</p>
                                <p><strong>Classes:</strong> ${selectedClasses.length}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Classes Defined:</strong></p>
                                <div>
                                    ${selectedClasses.map(c => `<span class="badge bg-primary me-1">${c}</span>`).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                    document.getElementById('projectInfoCard').style.display = 'block';
                    document.getElementById('nextTaskBtn').style.display = 'inline-block';
                    
                    // Scroll to project info
                    document.getElementById('projectInfoCard').scrollIntoView({ behavior: 'smooth' });
                } else {
                    throw new Error(data.error || 'Failed to create project');
                }
            } catch (error) {
                document.getElementById('projectStatus').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>Error: ${error.message}
                    </div>
                `;
                document.getElementById('projectStatus').style.display = 'block';
            }
        }

        // Check if project exists
        window.addEventListener('DOMContentLoaded', () => {
            const savedProjectId = localStorage.getItem('level3_project_id');
            if (savedProjectId) {
                // Load existing project info
                // This could fetch from backend in future
            }
        });
    </script>
</body>
</html>

